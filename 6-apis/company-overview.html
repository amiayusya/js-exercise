<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script type="text/javascript">
    // Always prompt for the API Key on page load
    var apiKey = prompt("Please enter your AlphaVantage API key:");
    sessionStorage.setItem("ALPHAVANTAGE_API_KEY", apiKey);

    // ELEMENT REFERENCES
    var inputSymbol = document.getElementById("input-symbol");
    var lookupButton = document.getElementById("lookup");

    var displayName = document.getElementById("display-name");
    var displayDesc = document.getElementById("display-description");
    var displayLink = document.getElementById("display-link");

    // FUNCTION DEFINITION
    function lookupCompany() {
        var symbol = inputSymbol.value.trim().toUpperCase();
        console.log("SYMBOL:", symbol);

        var requestUrl = `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${apiKey}`;

        d3.json(requestUrl).then(function(data) {
            console.log("RESPONSE:", data);

            console.log("---------------------");
            console.log("PART 1...");
            console.log(data.Symbol);
            console.log(data.Name);
            console.log(data.Description);
            console.log(data.Website);

            console.log("---------------------");
            console.log("PART 2...");

            displayName.innerText = data.Name || "N/A";
            displayDesc.innerText = data.Description || "No description available.";
            
            if (data.Website) {
                displayLink.innerText = data.Website;
                displayLink.href = data.Website;
            } else {
                displayLink.innerText = "N/A";
                displayLink.href = "#";
            }

        }).catch(function(error) {
            console.error("ERROR:", error);
        });
    }

    // FUNCTION INVOCATIONS
    // Load default company on page load
    lookupCompany();

    // Re-lookup when user clicks the button
    lookupButton.addEventListener("click", lookupCompany, false);
</script>
